### Buscar saldo de cliente (via Elasticsearch direto)
GET http://localhost:9200/ciclo_vida_recebivel/_search?pretty=
Content-Type: application/json

{
  "size": 0,
  "query": {
    "bool": {
      "must": [
        {
          "term": {
            "codigo_cliente.keyword": "123456"
          }
        },
        {
          "range": {
            "data_vencimento": {
              "gte": "2025-01-01",
              "lte": "2028-12-31"
            }
          }
        }
      ]
    }
  },
  "aggs": {
    "saldo_total": {
      "scripted_metric": {
        "init_script": "state.saldo_total = 0.0",
        "map_script": "double saldo = doc['valor_original'].value; if (params._source.cancelamentos != null) { for (def c : params._source.cancelamentos) { saldo -= c.valor_cancelado; } } if (params._source.negociacoes != null) { for (def n : params._source.negociacoes) { saldo -= n.valor_negociado; } } state.saldo_total += saldo;",
        "combine_script": "return state.saldo_total",
        "reduce_script": "double total = 0; for (s in states) { total += s; } return Math.round(total * 100.0) / 100.0"
      }
    }
  }
}
